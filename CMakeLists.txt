cmake_minimum_required(VERSION 3.16)
project(veriloga_frontend LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# vcpkg root (adjust if different)
set(VCPKG_ROOT "$ENV{HOME}/vcpkg")

# two include roots: parent and the antlr4-runtime subfolder
set(ANTLR4_INCLUDE_ROOT "${VCPKG_ROOT}/installed/x64-linux/include")
set(ANTLR4_INCLUDE_SUB  "${ANTLR4_INCLUDE_ROOT}/antlr4-runtime")
set(ANTLR4_LIBRARY     "${VCPKG_ROOT}/installed/x64-linux/lib/libantlr4-runtime.a")

if(NOT EXISTS "${ANTLR4_INCLUDE_SUB}/antlr4-runtime.h")
  message(FATAL_ERROR "Could not find antlr4-runtime.h in ${ANTLR4_INCLUDE_SUB}. Please adjust VCPKG_ROOT or install the runtime.")
endif()
if(NOT EXISTS "${ANTLR4_LIBRARY}")
  message(FATAL_ERROR "Could not find antlr4 runtime lib at ${ANTLR4_LIBRARY}. Please install via vcpkg or adjust path.")
endif()

# -- Sources generated by ANTLR (CPP files in generated/)
file(GLOB_RECURSE ANTLR_SRC "${CMAKE_SOURCE_DIR}/generated/*.cpp")
file(GLOB_RECURSE ANTLR_HDR "${CMAKE_SOURCE_DIR}/generated/*.h")

# library built from generated ANTLR sources
add_library(veriloga_parser ${ANTLR_SRC})

# Make generated/ visible for includes and add ANTLR include roots (PUBLIC so consumers inherit)
target_include_directories(veriloga_parser PUBLIC
  "${CMAKE_SOURCE_DIR}/generated"
  "${ANTLR4_INCLUDE_SUB}"
  "${ANTLR4_INCLUDE_ROOT}"
)

# Link ANTLR runtime (PUBLIC so the executable linking veriloga_parser also links runtime)
target_link_libraries(veriloga_parser PUBLIC "${ANTLR4_LIBRARY}")

# -- Your application
file(GLOB_RECURSE PROJECT_SRC "${CMAKE_SOURCE_DIR}/src/*.cpp")
add_executable(vlgc ${PROJECT_SRC})

# vlgc links the generated parser library (which brings ANTLR includes & lib via PUBLIC)
find_package(Eigen3 REQUIRED)
target_link_libraries(vlgc PRIVATE veriloga_parser Eigen3::Eigen)
# Optional: install target
install(TARGETS vlgc RUNTIME DESTINATION bin)

